import{_ as s,a as e,a2 as p,o as t}from"./chunks/framework.DAlL-BGO.js";const n="/assets/image-7.BeuTrGpa.png",v=JSON.parse('{"title":"","description":"","frontmatter":{"lastUpdated":"2023-12-18 22:22"},"headers":[],"relativePath":"pages/安装手册/Docker安装vsftp.md","filePath":"pages/安装手册/Docker安装vsftp.md","lastUpdated":1733806965000}'),i={name:"pages/安装手册/Docker安装vsftp.md"};function l(d,a,c,o,r,h){return t(),e("div",null,a[0]||(a[0]=[p(`<h2 id="_1-下载" tabindex="-1">1 下载 <a class="header-anchor" href="#_1-下载" aria-label="Permalink to &quot;1 下载&quot;">​</a></h2><p>下载镜像</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ docker pull fauria/vsftpd</span></span></code></pre></div><h2 id="_2-主动模式启动" tabindex="-1">2 主动模式启动 <a class="header-anchor" href="#_2-主动模式启动" aria-label="Permalink to &quot;2 主动模式启动&quot;">​</a></h2><p>主动模式下在登录成功后，需要客户端开放动态端口，由FTP主动连接客户端，形成连接。需要客户端在防火墙允许动态端口。</p><p>创建外部保存文件的位置</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ mkdir -p /opt/files</span></span></code></pre></div><p>启动</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ docker run -d -v /opt/files:/home/vsftpd \\</span></span>
<span class="line"><span>      -p 21:21 \\</span></span>
<span class="line"><span>      -e FTP_USER=izqy -e FTP_PASS=123456 \\</span></span>
<span class="line"><span>      --name vsftpd --restart=always fauria/vsftpd</span></span></code></pre></div><p>防火墙需要开放<code>21</code>端口</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ firewall-cmd --add-port=21/tcp --permanent</span></span>
<span class="line"><span>$ firewall-cmd --reload</span></span></code></pre></div><p>至此启动成功，使用<code>winscp</code>软件连接ftp测试，连接过程中出现错误如下</p><blockquote><p>Server sent passive reply with unroutable address 172.17.0.3, using host address instead.</p></blockquote><p>在连接选项中的<code>高级</code>中设置连接模式，关闭<code>被动模式</code></p><p><img src="`+n+`" alt="alt text"></p><h2 id="_3-双模式启动" tabindex="-1">3 双模式启动 <a class="header-anchor" href="#_3-双模式启动" aria-label="Permalink to &quot;3 双模式启动&quot;">​</a></h2><p>被动模式下在登录成功后，服务端开放动态端口，由客户端连接FTP服务器，形成连接。需要FTP服务器的防火墙允许动态端口。</p><p>主动模式和被动模式双模式启动,开放用于客户端连接的其他接口，设置接口范围 <code>21100-21110</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ docker run -d -v /opt/files:/home/vsftpd \\</span></span>
<span class="line"><span>      -p 20:20 -p 21:21 -p 21100-21110:21100-21110 \\</span></span>
<span class="line"><span>      -e FTP_USER=izqy -e FTP_PASS=123456 \\</span></span>
<span class="line"><span>      -e PASV_ADDRESS=192.111.0.111 \\</span></span>
<span class="line"><span>      -e PASV_MIN_PORT=21100 -e PASV_MAX_PORT=21110 \\</span></span>
<span class="line"><span>      --name vsftpd --restart=always fauria/vsftpd</span></span></code></pre></div><p>其中 <code>192.111.0.111</code> 是服务器IP, 防火墙需要开放<code>21</code>端口，阿里云服务器中 PASV_ADDRESS 需要设置成公网IP，否则的话 vpc 中的机器无法使用内网 ip 访问 ftp</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ firewall-cmd --add-port=20-21/tcp --permanent</span></span>
<span class="line"><span>$ firewall-cmd --add-port=21100-21110/tcp --permanent</span></span>
<span class="line"><span>$ firewall-cmd --reload</span></span></code></pre></div><p>使用<code>winscp</code>软件直接连接ftp进行测试</p><h2 id="_4-添加用户" tabindex="-1">4 添加用户 <a class="header-anchor" href="#_4-添加用户" aria-label="Permalink to &quot;4 添加用户&quot;">​</a></h2><p>添加一个 <code>izqy2</code>用户，密码是 <code>123456</code></p><p>进入容器</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ docker exec -i -t vsftpd bash</span></span></code></pre></div><p>添加用户目录</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ mkdir /home/vsftpd/izqy2</span></span></code></pre></div><p>创建用户，密码并重载配置</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ echo -e &quot;izqy2\\n123456&quot; &gt;&gt; /etc/vsftpd/virtual_users.txt</span></span>
<span class="line"><span>$ /usr/bin/db_load -T -t hash -f /etc/vsftpd/virtual_users.txt /etc/vsftpd/virtual_users.db</span></span></code></pre></div><p>退出容器</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ exit</span></span></code></pre></div><p>重启容器</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ docker restart vsftpd</span></span></code></pre></div>`,34)]))}const g=s(i,[["render",l]]);export{v as __pageData,g as default};
