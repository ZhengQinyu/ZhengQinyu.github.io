import{_ as i,a,a2 as l,o as e}from"./chunks/framework.DAlL-BGO.js";const c=JSON.parse('{"title":"MySQL8安装，配置主从复制","description":"","frontmatter":{"title":"MySQL8安装，配置主从复制","lastUpdated":"2024-12-03 15:43"},"headers":[],"relativePath":"install/mysql-install.md","filePath":"install/mysql-install.md","lastUpdated":1733806965000}'),n={name:"install/mysql-install.md"};function t(p,s,h,o,d,k){return e(),a("div",null,s[0]||(s[0]=[l(`<p>记录一次在<code>CentOS8</code>下使用<code>dnf</code>安装<code>MySQL8</code>(本次配置使用8.0.21)，并配置主从复制的过程</p><h2 id="_1-安装" tabindex="-1">1 安装 <a class="header-anchor" href="#_1-安装" aria-label="Permalink to &quot;1 安装&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dnf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @mysql</span></span></code></pre></div><h2 id="_2-启动" tabindex="-1">2. 启动 <a class="header-anchor" href="#_2-启动" aria-label="Permalink to &quot;2. 启动&quot;">​</a></h2><p>设置开机自启并立即启动</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld</span></span></code></pre></div><h2 id="_3-查看状态" tabindex="-1">3. 查看状态 <a class="header-anchor" href="#_3-查看状态" aria-label="Permalink to &quot;3. 查看状态&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld</span></span></code></pre></div><h2 id="_4-安全配置" tabindex="-1">4. 安全配置 <a class="header-anchor" href="#_4-安全配置" aria-label="Permalink to &quot;4. 安全配置&quot;">​</a></h2><p>执行配置命令</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql_secure_installation</span></span></code></pre></div><p>按照以下步骤设置：</p><ul><li>Press y|Y for Yes, any other key for No: y [<strong>说明：确认并继续设置</strong>]</li><li>Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 2 [<strong>说明：密码强度</strong>]</li><li>New password: [ENTER STRONG PASSWORD HERE] [<strong>说明：输入密码</strong>]</li><li>Re-enter new password: RE ENTER PASSWORD HERE [<strong>说明：确认密码</strong>]</li><li>Do you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : y [<strong>说明：确认使用设置的密码</strong>]</li><li>Remove anonymous users? (Press y|Y for Yes, any other key for No) : y [<strong>说明：移除匿名用户</strong>]</li><li>Disallow root login remotely? (Press y|Y for Yes, any other key for No) : y [<strong>说明：禁止root用户远程访问</strong>]</li><li>Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y [<strong>说明：移除测试的数据库</strong>]</li><li>Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y [<strong>说明：重新加载权限相关的表</strong>]</li></ul><h2 id="_5-主从复制配置" tabindex="-1">5. 主从复制配置 <a class="header-anchor" href="#_5-主从复制配置" aria-label="Permalink to &quot;5. 主从复制配置&quot;">​</a></h2><ul><li>服务IP</li></ul><blockquote><p>主服务器： 192.168.0.15 从服务器： 192.168.0.16</p></blockquote><ul><li>主服务器配置</li></ul><p>修改主服务器的配置文件 <code>mysql-server.cnf</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/my.cnf.d/mysql-server.cnf</span></span></code></pre></div><p>添加以下配置, server-id一般设置每个服务不一样即可，可以使用IP最后一段</p><blockquote><p>server-id = 15 log-bin = /var/log/mysql/mysql-bin</p></blockquote><p><code>log-bin</code>目录需要允许mysql用户访问</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql:mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/mysql</span></span></code></pre></div><p>重启mysql</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld</span></span></code></pre></div><p>进入mysql控制台后， 添加用于同步数据的数据库用户, 例如用户名是 <code>zqyu_rpl</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; create user zqyu_rpl@192.168.0.16 identified by &#39;zqyu123456&#39;;</span></span>
<span class="line"><span>&gt; grant replication slave on *.* to zqyu_rpl@192.168.0.16;</span></span>
<span class="line"><span>&gt; flush privileges;</span></span></code></pre></div><p>主服务器开放数据库端口给从服务器（或者直接开放3306端口）</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-rich-rule=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        rule family=&quot;ipv4&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        source address=&quot;192.168.0.16/32&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        port protocol=&quot;tcp&quot; port=&quot;3306&quot; accept&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --add-port=3306/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 最后</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre></div><p>查看并记录主服务器状态</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; show master status\\G;</span></span></code></pre></div><p>显示如下，需要用户的属性是 <code>File</code> 和 <code>Position</code> ，作为下面从服务器配置的起始点</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>*************************** 1. row ***************************</span></span>
<span class="line"><span>File: mysql-bin.000001</span></span>
<span class="line"><span>Position: 853</span></span>
<span class="line"><span>Binlog_Do_DB: </span></span>
<span class="line"><span>Binlog_Ignore_DB: </span></span>
<span class="line"><span>Executed_Gtid_Set: </span></span>
<span class="line"><span>1 row in set (0.00 sec</span></span></code></pre></div><ul><li>从服务器配置</li></ul><p>修改从服务器的配置文件 <code>mysql-server.cnf</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/my.cnf.d/mysql-server.cnf</span></span></code></pre></div><p>添加以下配置</p><blockquote><p>server-id = 16 log-bin = /var/log/mysql/mysql-bin read_only = 1</p></blockquote><p><code>log-bin</code>目录需要允许mysql用户访问</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql:mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/mysql</span></span></code></pre></div><p>重启mysql</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld</span></span></code></pre></div><p>进入mysql控制台后， 配置主服务器的信息，其中 <code>MASTER_LOG_FILE</code>和<code>MASTER_LOG_POS</code>就是上面主服务器记录的属性值, 配置完成后执行 <code>start slave</code>开启同步</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; CHANGE MASTER TO MASTER_HOST=&#39;192.168.0.15&#39;, MASTER_USER=&#39;zqyu_rpl&#39;, MASTER_PASSWORD=&#39;zqyu123456&#39;,  MASTER_LOG_FILE=&#39;mysql-bin.000001&#39;, MASTER_LOG_POS=853;</span></span>
<span class="line"><span>&gt; start slave;</span></span></code></pre></div><p>查看同步状态</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; show slave status\\G</span></span></code></pre></div><p>确认属性如下即可</p><blockquote><p>Slave_IO_Running: Yes # 或者 Connecting Slave_SQL_Running: Yes</p></blockquote><h2 id="_6-注意" tabindex="-1">6. 注意 <a class="header-anchor" href="#_6-注意" aria-label="Permalink to &quot;6. 注意&quot;">​</a></h2><p>如果需要修改保存位置，socket 和 socketx 默认保存位置都是 <code>/var/lib/mysql</code>, 修改的话最好两个都改,例如：</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[mysqld]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">datadir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/home/zqyu/mysql-data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/home/zqyu/mysql-data/mysql.sock</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mysqlx_socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/home/zqyu/mysql-data/mysqlx.sock</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log-error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/home/zqyu/mysql-log/mysqld.log</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pid-file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/run/mysqld/mysqld.pid</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 5</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log-bin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = /home/zqyu/mysql-log/mysql-bin</span></span></code></pre></div>`,53)]))}const g=i(n,[["render",t]]);export{c as __pageData,g as default};
