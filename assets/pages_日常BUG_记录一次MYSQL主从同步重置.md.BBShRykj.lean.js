import{_ as s,a as e,a2 as p,o as n}from"./chunks/framework.DAlL-BGO.js";const g=JSON.parse('{"title":"","description":"","frontmatter":{"lastUpdated":"2023-12-18 22:22"},"headers":[],"relativePath":"pages/日常BUG/记录一次MYSQL主从同步重置.md","filePath":"pages/日常BUG/记录一次MYSQL主从同步重置.md","lastUpdated":1733806965000}'),l={name:"pages/日常BUG/记录一次MYSQL主从同步重置.md"};function t(i,a,o,c,d,u){return n(),e("div",null,a[0]||(a[0]=[p(`<h3 id="一-背景介绍" tabindex="-1">一. 背景介绍 <a class="header-anchor" href="#一-背景介绍" aria-label="Permalink to &quot;一. 背景介绍&quot;">​</a></h3><p>线上数据库从库挂掉，所以重新安装并重新同步</p><h3 id="二-主库备份" tabindex="-1">二. 主库备份 <a class="header-anchor" href="#二-主库备份" aria-label="Permalink to &quot;二. 主库备份&quot;">​</a></h3><ul><li>登录主库</li></ul><p>登录主库，输入以下命令并输入密码</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ mysql -u root -p</span></span></code></pre></div><ul><li>锁表</li></ul><p>锁表后数据库不能写入数据，操作需谨慎。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ FLUSH TABLES WITH READ LOCK;</span></span></code></pre></div><ul><li>备份全部数据库</li></ul><p>退出登录并导出全部的数据库，同时压缩一下便于传输。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ mysqldump -u root -p --all-databases &gt; bak.sql | gzip &gt; bak.sql.gz</span></span></code></pre></div><ul><li>查看主库Binlog文件和位置</li></ul><p>登录主库并查看信息</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$  mysql -u root -p </span></span>
<span class="line"><span>$ show master status;</span></span></code></pre></div><p>显示信息如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>+---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span>| File          |  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span>
<span class="line"><span>+---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span>| binlog.000024 | 11632560 |              |                  |                   |</span></span>
<span class="line"><span>+---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span>1 row in set (0.01 sec)</span></span></code></pre></div><ul><li>主库解锁</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ UNLOCK TABLES;</span></span></code></pre></div><h3 id="三-从库恢复" tabindex="-1">三. 从库恢复 <a class="header-anchor" href="#三-从库恢复" aria-label="Permalink to &quot;三. 从库恢复&quot;">​</a></h3><ul><li>传输备份文件并解压</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gunzip bak.sql.gz</span></span></code></pre></div><ul><li>恢复数据</li></ul><p>重新安装从库，并恢复数据</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ mysql -u root -p &lt; bak.sql</span></span></code></pre></div><ul><li>登录从库并开启从库同步</li></ul><p>主库IP是 <code>198.168.0.2</code>, 同步用户是<code>zqyu_rpl</code>, 密码是<code>123456</code>， <code>MASTER_LOG_FILE</code> 和 <code>MASTER_LOG_POS</code> 是主库中使用 <code>show master status;</code>查看到的信息。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ CHANGE MASTER TO MASTER_HOST=&#39;198.168.0.2&#39;, MASTER_USER=&#39;zqyu_rpl&#39;, MASTER_PASSWORD=&#39;123456&#39;,MASTER_LOG_FILE=&#39;binlog.000024&#39;, MASTER_LOG_POS=11632560;</span></span></code></pre></div><ul><li>开启从库同步</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>start slave;</span></span></code></pre></div><p>使用下面命令查看从库同步状态</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>show slave status\\G;</span></span></code></pre></div><p>确认属性如下即可</p><blockquote><p>Slave_IO_Running: Yes # 或者 Connecting Slave_SQL_Running: Yes</p></blockquote><ul><li>其它命令</li></ul><p>重置从库同步的命令</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ stop slave; # 停止从库同步</span></span>
<span class="line"><span>$ reset slave; # 重置</span></span>
<span class="line"><span>$ start slave; # 开启</span></span></code></pre></div><p>配置主从同步 <a href="/install/mysql-install.html">MySQL8安装，配置主从复制</a></p>`,38)]))}const r=s(l,[["render",t]]);export{g as __pageData,r as default};
