import{_ as a,a as t,a2 as s,o}from"./chunks/framework.DAlL-BGO.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{"lastUpdated":"2023-12-18 22:22"},"headers":[],"relativePath":"pages/Docker/Docker容器修改时区.md","filePath":"pages/Docker/Docker容器修改时区.md","lastUpdated":1733806965000}'),i={name:"pages/Docker/Docker容器修改时区.md"};function n(c,e,r,l,p,d){return o(),t("div",null,e[0]||(e[0]=[s(`<h2 id="还是没解决" tabindex="-1"><strong>还是没解决</strong> <a class="header-anchor" href="#还是没解决" aria-label="Permalink to &quot;**还是没解决**&quot;">​</a></h2><h3 id="_1-背景" tabindex="-1">1. 背景 <a class="header-anchor" href="#_1-背景" aria-label="Permalink to &quot;1. 背景&quot;">​</a></h3><p>最近发现使用 <code>hikariCP</code> 连接MYSQL数据库（使用Docker安装8.0.20）时，总是出现错误如下：</p><blockquote><p>Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@4c4180c8 (No operations allowed after connection closed.). Possibly consider using a shorter maxLifetime value.</p></blockquote><p>检查数据库的 <code>mysqlx_wait_timeout</code> 和 <code>wait_timeout</code> 参数是 28800 秒， <code>hikari</code>的连接配置参数 <code>spring.datasource.hikari.max-lifetime</code> 参数是 1800000 毫秒；正常来说应该不会报这个错误的。</p><h3 id="_2-解决" tabindex="-1">2. 解决 <a class="header-anchor" href="#_2-解决" aria-label="Permalink to &quot;2. 解决&quot;">​</a></h3><p>最后在 <a href="https://github.com/brettwooldridge/HikariCP#configuration-knobs-baby" target="_blank" rel="noreferrer">hikariCP</a>文档中发现这一段描述</p><blockquote><p>HikariCP relies on accurate timers for both performance and reliability. It is <em>imperative</em> that your server is synchronized with a time-source such as an NTP server. <em>Especially</em> if your server is running within a virtual machine. Why? <a href="https://dba.stackexchange.com/a/171020" target="_blank" rel="noreferrer">Read more here</a>. <strong>Do not rely on hypervisor settings to &quot;synchronize&quot; the clock of the virtual machine. Configure time-source synchronization inside the virtual machine.</strong> If you come asking for support on an issue that turns out to be caused by lack time synchronization, you will be taunted publicly on Twitter.</p></blockquote><p>主要意思就是服务器（这里指数据库服务器，镜像中运行的话指容器中的时间）中的需与时间源（例如NTP服务器）同步。</p><ul><li>查看容器时间</li></ul><p>这里的 <code>mysq8</code> 是容器的别名</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ docker exec -it mysq8 date</span></span></code></pre></div><p>显示的是</p><blockquote><p>Wed Nov 25 07:26:44 UTC 2020</p></blockquote><p>实际外部时间是</p><blockquote><p>Wed Nov 25 15:26:49 CST 2020</p></blockquote><p>数据库的时区</p><p>show variables like &#39;%time_zone%&#39;;</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>| system_time_zone | CST   |</span></span>
<span class="line"><span>|  time_zone | SYSTEM |</span></span></code></pre></div><p>命令记录</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mv /etc/localtime /etc/localtime.backup</span></span>
<span class="line"><span>ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span>
<span class="line"><span></span></span>
<span class="line"><span>或者直接复制</span></span>
<span class="line"><span>cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span></code></pre></div>`,21)]))}const m=a(i,[["render",n]]);export{u as __pageData,m as default};
