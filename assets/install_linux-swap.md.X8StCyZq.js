import{_ as i,a,a2 as l,o as e}from"./chunks/framework.DAlL-BGO.js";const r=JSON.parse('{"title":"Linux配置与管理SWAP","description":"","frontmatter":{"title":"Linux配置与管理SWAP","lastUpdated":"2024-12-03 15:43"},"headers":[],"relativePath":"install/linux-swap.md","filePath":"install/linux-swap.md","lastUpdated":1733807682000}'),t={name:"install/linux-swap.md"};function p(h,s,n,d,k,o){return e(),a("div",null,s[0]||(s[0]=[l('<h3 id="一、什么是-swap" tabindex="-1">一、什么是 SWAP？ <a class="header-anchor" href="#一、什么是-swap" aria-label="Permalink to &quot;一、什么是 SWAP？&quot;">​</a></h3><p>SWAP 是一种虚拟内存机制，当物理内存不足时，Linux 内核会将一部分数据暂时移出到硬盘上的一个特殊区域，这个区域就是 SWAP 空间。SWAP 可以是硬盘上的一个文件或一个专用的分区。</p><h3 id="二、swap-的作用" tabindex="-1">二、SWAP 的作用 <a class="header-anchor" href="#二、swap-的作用" aria-label="Permalink to &quot;二、SWAP 的作用&quot;">​</a></h3><ol><li>内存不足时的扩展：当系统的物理内存被占满，SWAP 可以作为额外的内存空间。</li><li>进程休眠：当某个进程暂时不需要执行但又不能被完全删除时，其内存内容可以被移到 SWAP 中，释放物理内存给更活跃的进程使用。</li><li>内存管理辅助：操作系统可以利用 SWAP 进行内存页的换入换出操作，优化内存使用效率。</li></ol><h3 id="三、swap-的配置方法" tabindex="-1">三、SWAP 的配置方法 <a class="header-anchor" href="#三、swap-的配置方法" aria-label="Permalink to &quot;三、SWAP 的配置方法&quot;">​</a></h3><ul><li>创建 SWAP 文件</li></ul><p>决定 SWAP 文件的大小，可以根据物理内存和实际用途来考虑。如果按照物理内存考虑的话，可以参考下面的建议</p><blockquote><p>小于 2GB 的物理内存：建议 SWAP 空间的大小至少是物理内存的两倍。 2GB 至 8GB 的物理内存：SWAP 空间的大小可以设置为物理内存的 1.5 倍。 大于 8GB 的物理内存：SWAP 空间的大小通常设置为物理内存的大小，或者更小一些，例如 4GB 或 8GB。</p></blockquote><p>例如创建1G的空间</p><p>建议方式（速度快）</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fallocate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /swapfile</span></span></code></pre></div><p>或者使用 <code>dd</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> if=/dev/zero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of=/swapfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bs=1M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span></span></code></pre></div><ul><li>设置权限</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /swapfile</span></span></code></pre></div><ul><li>格式化</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkswap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /swapfile</span></span></code></pre></div><ul><li>启用 SWAP</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swapon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /swapfile</span></span></code></pre></div><ul><li>设置开机启动</li></ul><p>编辑 <code>/etc/fstab</code> 文件，添加以下行以确保 SWAP 在系统启动时自动启用。</p><blockquote><p>/swapfile none swap defaults 0 0</p></blockquote><p>执行以下脚本直接写入更方便</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/swapfile none swap defaults 0 0&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/fstab</span></span></code></pre></div><h3 id="四、调整-swap-使用策略" tabindex="-1">四、调整 SWAP 使用策略 <a class="header-anchor" href="#四、调整-swap-使用策略" aria-label="Permalink to &quot;四、调整 SWAP 使用策略&quot;">​</a></h3><p>通过调整 /proc/sys/vm/swappiness 文件中的值，可以控制 SWAP 的使用倾向。值范围是 0 到 100。 <strong>该参数的含义可以理解为 “内存空间剩余多少时，开始使用swap”</strong></p><ul><li>查看该值</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/vm/swappiness</span></span></code></pre></div><ul><li>临时调整，重启失效</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vm.swappiness=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span></code></pre></div><ul><li>永久调整</li></ul><p>编辑 <code>/etc/sysctl.conf</code>, 添加或修改 <code>vm.swappiness = 10</code>,然后执行以下命令使更改生效即可</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></div><h3 id="五、修改swap-的大小" tabindex="-1">五、修改SWAP 的大小 <a class="header-anchor" href="#五、修改swap-的大小" aria-label="Permalink to &quot;五、修改SWAP 的大小&quot;">​</a></h3><p>可以先取消挂载，然后删除文件后重新创建，重新挂载即可。</p><ul><li>取消挂载</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swapoff</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /swapfile</span></span></code></pre></div>',37)]))}const g=i(t,[["render",p]]);export{r as __pageData,g as default};
